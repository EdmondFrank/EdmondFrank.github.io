
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="ja"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>EdmondFrank's 时光足迹</title>
  <meta name="author" content="EdmondFrank">

  
  <meta name="description" content="Xlib编程之-创建全屏透明窗口 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://edmondfrank.github.io/posts/3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="EdmondFrank's 时光足迹" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.cat.net/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  

</head>

<body >
  <div id="container">
    <header role="banner"><hgroup>
  <h1><a href="/">EdmondFrank's 时光足迹</a></h1>
  
    <h2>この先は暗い夜道だけかもしれない　それでも信じて進むんだ。星がその道を少しでも照らしてくれるのを。</h2>
  
</hgroup>

</header>
    <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="site:edmondfrank.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
    <div id="main">
      <div id="content">
        <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/21/xlibbian-cheng-zhi-chuang-jian-quan-ping-tou-ming-chuang-kou/">Xlib编程之-创建全屏透明窗口</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-10-21T20:11:20+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>Xlib编程之-创建全屏透明窗口</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="c1">//source file : win.c</span>
</span><span class='line'> <span class="cp">#include &lt;X11/Xlib.h&gt;</span>
</span><span class='line'> <span class="cp">#include &lt;X11/Xutil.h&gt;</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>    <span class="n">Display</span><span class="o">*</span> <span class="n">display</span> <span class="o">=</span> <span class="n">XOpenDisplay</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">XVisualInfo</span> <span class="n">vinfo</span><span class="p">;</span>
</span><span class='line'>    <span class="n">XMatchVisualInfo</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">DefaultScreen</span><span class="p">(</span><span class="n">display</span><span class="p">),</span> <span class="mi">32</span><span class="p">,</span> <span class="n">TrueColor</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vinfo</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">XSetWindowAttributes</span> <span class="n">attr</span><span class="p">;</span><span class="c1">//窗口属性设置</span>
</span><span class='line'>    <span class="n">attr</span><span class="p">.</span><span class="n">colormap</span> <span class="o">=</span> <span class="n">XCreateColormap</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">DefaultRootWindow</span><span class="p">(</span><span class="n">display</span><span class="p">),</span> <span class="n">vinfo</span><span class="p">.</span><span class="n">visual</span><span class="p">,</span> <span class="n">AllocNone</span><span class="p">);</span>
</span><span class='line'>    <span class="n">attr</span><span class="p">.</span><span class="n">border_pixel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">attr</span><span class="p">.</span><span class="n">background_pixel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//取输出设备的长宽像素</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">screen</span> <span class="o">=</span> <span class="n">DefaultScreen</span><span class="p">(</span><span class="n">display</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">DisplayHeight</span><span class="p">(</span><span class="n">display</span><span class="p">,</span><span class="n">screen</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">DisplayWidth</span><span class="p">(</span><span class="n">display</span><span class="p">,</span><span class="n">screen</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//开始创建窗口</span>
</span><span class='line'>    <span class="n">Window</span> <span class="n">win</span> <span class="o">=</span> <span class="n">XCreateWindow</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">DefaultRootWindow</span><span class="p">(</span><span class="n">display</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vinfo</span><span class="p">.</span><span class="n">depth</span><span class="p">,</span> <span class="n">InputOutput</span><span class="p">,</span> <span class="n">vinfo</span><span class="p">.</span><span class="n">visual</span><span class="p">,</span>  <span class="n">CWColormap</span> <span class="o">|</span> <span class="n">CWBorderPixel</span> <span class="o">|</span> <span class="n">CWBackPixel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">);</span>
</span><span class='line'>    <span class="n">XSelectInput</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">StructureNotifyMask</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//GC gc = XCreateGC(display, win, 0, 0);</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">    Atom wm_delete_window = XInternAtom(display, &quot;WM_DELETE_WINDOW&quot;, 0);</span>
</span><span class='line'><span class="cm">    XSetWMProtocols(display, win, &amp;wm_delete_window, 1);</span>
</span><span class='line'><span class="cm">    */</span>
</span><span class='line'>    <span class="n">XMapWindow</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">win</span><span class="p">);</span>
</span><span class='line'>    <span class="n">XMoveWindow</span><span class="p">(</span><span class="n">display</span><span class="p">,</span><span class="n">win</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">XFlush</span><span class="p">(</span><span class="n">display</span><span class="p">);</span><span class="c1">//刷新输出设备</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">keep_running</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="n">XEvent</span> <span class="n">event</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//窗口事件监听尝试</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">keep_running</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">XNextEvent</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">);</span>
</span><span class='line'>        <span class="k">switch</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="nl">ClientMessage</span><span class="p">:</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">xclient</span><span class="p">.</span><span class="n">message_type</span> <span class="o">==</span> <span class="n">XInternAtom</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="s">&quot;WM_PROTOCOLS&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">Atom</span><span class="p">)</span><span class="n">event</span><span class="p">.</span><span class="n">xclient</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">XInternAtom</span><span class="p">(</span><span class="n">display</span><span class="p">,</span><span class="s">&quot;WM_DELETE_WINDOW&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span class='line'>                    <span class="n">keep_running</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="k">default</span><span class="o">:</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//结束销毁</span>
</span><span class='line'>    <span class="n">XDestroyWindow</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">win</span><span class="p">);</span>
</span><span class='line'>    <span class="n">XCloseDisplay</span><span class="p">(</span><span class="n">display</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>编译</strong></p>

<blockquote><p>gcc -o win ./win.c -L/usr/lib -lX11</p></blockquote>

<p><strong>That is All</strong></p>
</div>
  
  


      <footer>
      
      - <a href="/blog/2016/10/21/xlibbian-cheng-zhi-chuang-jian-quan-ping-tou-ming-chuang-kou/">Xlib编程之-创建全屏透明窗口</a>
      <time datetime="2016-10-21T20:11:20+08:00" pubdate><span class='month'>Oct</span> <span class='day'>21</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/lian-xi-dai-ma/'>练习代码</a></span>
      
      </footer>
    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/10/12/tian-yi-xiao-yuan-wang-ke-hu-duan-deng-lu-xie-yi-geng-xin/">2016-10-12:天翼校园网客户端登录协议更新</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-10-12T22:14:07+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>天翼校园网客户端登录协议更新</h2>

<p><strong>PS:此登录协议仅供参考,未必适合所有高校.</strong>
<strong>本项目源码不遵循任何协议,各位可以随意下载及修改,但请勿用作非法 or 商业用途!</strong></p>

<h3>主要变化</h3>

<p><strong><a href="https://github.com/EdmondFrank/Esurfing">原登录协议</a> 步骤为:challange -> 获取rescode -> login,现登录协议取消了rescode认证,因此可以省略challange可以直接login</strong></p>

<h3>登录协议主要源码如下:</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#coding:utf-8</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;json&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;digest/md5&#39;</span>
</span><span class='line'><span class="n">body</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;./config.json&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">config</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span class='line'><span class="n">username</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">].</span><span class="n">to_s</span>
</span><span class='line'><span class="n">password</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">].</span><span class="n">to_s</span>
</span><span class='line'><span class="n">clientip</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;clientip&quot;</span><span class="o">].</span><span class="n">to_s</span>
</span><span class='line'><span class="n">nasip</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;nasip&quot;</span><span class="o">].</span><span class="n">to_s</span>
</span><span class='line'><span class="n">mac</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="s2">&quot;mac&quot;</span><span class="o">].</span><span class="n">to_s</span>
</span><span class='line'><span class="n">iswifi</span><span class="o">=</span><span class="s2">&quot;1050&quot;</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_timestamp</span><span class="p">()</span>
</span><span class='line'>  <span class="k">return</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">to_i</span><span class="o">.</span><span class="n">to_s</span><span class="o">+</span><span class="s1">&#39;444&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_md5</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span>  <span class="no">Digest</span><span class="o">::</span><span class="no">MD5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(</span><span class="n">str</span><span class="o">+</span><span class="s1">&#39;Eshore!@#&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upcase</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">active</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">clientip</span><span class="p">,</span><span class="n">nasip</span><span class="p">,</span><span class="n">mac</span><span class="p">)</span>
</span><span class='line'>  <span class="n">timestamp</span> <span class="o">=</span> <span class="n">get_timestamp</span>
</span><span class='line'>  <span class="n">authenticator</span><span class="o">=</span> <span class="n">get_md5</span><span class="p">(</span><span class="n">clientip</span><span class="o">+</span><span class="n">nasip</span><span class="o">+</span><span class="n">mac</span><span class="o">+</span><span class="n">timestamp</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">username</span><span class="p">,</span><span class="n">clientip</span><span class="p">,</span><span class="n">nasip</span><span class="p">,</span><span class="n">mac</span><span class="p">,</span><span class="n">timestamp</span><span class="p">,</span><span class="n">authenticator</span>
</span><span class='line'>  <span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://enet.10000.gd.cn:8001/hbservice/client/active?username=</span><span class="si">#{</span><span class="n">username</span><span class="si">}</span><span class="s2">&amp;clientip=</span><span class="si">#{</span><span class="n">clientip</span><span class="si">}</span><span class="s2">&amp;nasip=</span><span class="si">#{</span><span class="n">nasip</span><span class="si">}</span><span class="s2">&amp;mac=</span><span class="si">#{</span><span class="n">mac</span><span class="si">}</span><span class="s2">&amp;timestamp=</span><span class="si">#{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&amp;authenticator=</span><span class="si">#{</span><span class="n">authenticator</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>  <span class="n">resp</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span class='line'>  <span class="c1">#resp = `curl -A &quot;&quot; -H &quot;Accept:&quot; -H &quot;Host:enet.10000.gd.cn:8001&quot; #{url}`</span>
</span><span class='line'>  <span class="n">result</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">result</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">result</span><span class="o">[</span><span class="s2">&quot;rescode&quot;</span><span class="o">].</span><span class="n">to_s</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">,</span><span class="n">clientip</span><span class="p">,</span><span class="n">nasip</span><span class="p">,</span><span class="n">mac</span><span class="p">,</span><span class="n">iswifi</span><span class="p">)</span>
</span><span class='line'>  <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://enet.10000.gd.cn:10001/client/login&quot;</span>
</span><span class='line'>  <span class="n">timestamp</span> <span class="o">=</span>  <span class="n">get_timestamp</span>
</span><span class='line'>  <span class="n">authenticator</span><span class="o">=</span><span class="n">get_md5</span><span class="p">(</span><span class="n">clientip</span><span class="o">+</span><span class="n">nasip</span><span class="o">+</span><span class="n">mac</span><span class="o">+</span><span class="n">timestamp</span><span class="p">)</span>
</span><span class='line'>  <span class="n">postdata</span><span class="o">=</span><span class="p">{}</span>
</span><span class='line'>  <span class="n">postdata</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]=</span><span class="n">username</span>
</span><span class='line'>  <span class="n">postdata</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]=</span><span class="n">password</span>
</span><span class='line'>  <span class="n">postdata</span><span class="o">[</span><span class="s2">&quot;clientip&quot;</span><span class="o">]=</span><span class="n">clientip</span>
</span><span class='line'>  <span class="n">postdata</span><span class="o">[</span><span class="s2">&quot;nasip&quot;</span><span class="o">]=</span><span class="n">nasip</span>
</span><span class='line'>  <span class="n">postdata</span><span class="o">[</span><span class="s2">&quot;mac&quot;</span><span class="o">]=</span><span class="n">mac</span>
</span><span class='line'>  <span class="n">postdata</span><span class="o">[</span><span class="s2">&quot;timestamp&quot;</span><span class="o">]=</span><span class="n">timestamp</span>
</span><span class='line'>  <span class="n">postdata</span><span class="o">[</span><span class="s2">&quot;authenticator&quot;</span><span class="o">]=</span><span class="n">authenticator</span>
</span><span class='line'>  <span class="n">postdata</span><span class="o">[</span><span class="s2">&quot;iswifi&quot;</span><span class="o">]=</span><span class="n">iswifi</span>
</span><span class='line'>  <span class="n">data</span><span class="o">=</span><span class="n">postdata</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="n">headers</span><span class="o">[</span><span class="s2">&quot;Host&quot;</span><span class="o">]=</span><span class="s2">&quot;enet.10000.gd.cn:10001&quot;</span>
</span><span class='line'>  <span class="n">headers</span><span class="o">[</span><span class="s2">&quot;Content-Length&quot;</span><span class="o">]=</span><span class="n">data</span><span class="o">.</span><span class="n">bytesize</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'>  <span class="n">headers</span><span class="o">[</span><span class="s2">&quot;Expect&quot;</span><span class="o">]=</span><span class="s2">&quot;100-continue&quot;</span>
</span><span class='line'>  <span class="n">headers</span><span class="o">[</span><span class="s2">&quot;Connection&quot;</span><span class="o">]=</span><span class="s2">&quot;Keep-Alive&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="sb">`curl -d &#39;</span><span class="si">#{</span><span class="n">data</span><span class="si">}</span><span class="sb">&#39; -A &quot;&quot; -H &quot;Accept:&quot; -H &quot;Content-Type:application/json&quot; -H &quot;Host:enet.10000.gd.cn:10001&quot; -H &quot;Content-Length:</span><span class="si">#{</span><span class="n">data</span><span class="o">.</span><span class="n">bytesize</span><span class="o">.</span><span class="n">to_s</span><span class="si">}</span><span class="sb">&quot; -H &quot;Expect:100-continue&quot; -H &quot;Connection:Keep-Alive&quot; -X POST </span><span class="si">#{</span><span class="n">url</span><span class="si">}</span><span class="sb">`</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">code</span> <span class="o">=</span> <span class="n">active</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">clientip</span><span class="p">,</span><span class="n">nasip</span><span class="p">,</span><span class="n">mac</span><span class="p">)</span>
</span><span class='line'><span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span>
</span><span class='line'>  <span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">,</span><span class="n">clientip</span><span class="p">,</span><span class="n">nasip</span><span class="p">,</span><span class="n">mac</span><span class="p">,</span><span class="n">iswifi</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>注:源码中才用了curl发送post包,使用前需先确认系统中是否用curl工具.若是改回Ruby的net/http发包请去掉[Expect]=&ldquo;100-continue"头</strong></p>

<p><strong>目前仅提供登录协议供大家参考,有能力者可自行实现完整程序及Gui界面,完整的程序(Cli版本/Gui版本),博主也会后续在我的<a href="https://github.com/EdmondFrank">Github</a>上发布</strong></p>
</div>
  
  


      <footer>
      
      - <a href="/blog/2016/10/12/tian-yi-xiao-yuan-wang-ke-hu-duan-deng-lu-xie-yi-geng-xin/">2016-10-12:天翼校园网客户端登录协议更新</a>
      <time datetime="2016-10-12T22:14:07+08:00" pubdate><span class='month'>Oct</span> <span class='day'>12</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/linuxza-tan/'>linux杂谈</a></span>
      
      </footer>
    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/21/cong-ling-kai-shi-de-rust-enumeratefang-fa/">从零开始的Rust-Enumerate方法</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-09-21T19:37:14+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>从零开始的Rust学习之旅-Enumerate方法</h2>

<p>Enumerate方法
当你需要记录你已经循环了多少次了的时候,你可以使用 .enumerate()函数。</p>

<h3>对范围(On ranges):</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span><span class="mf">5.</span><span class="p">.</span><span class="mi">10</span><span class="p">).</span><span class="n">enumerate</span><span class="p">()</span>  
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;i  =   {}  and j   =   {}&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>    <span class="n">j</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>输出:<br/>
i = 0 and j = 5 <br/>
i = 1 and j = 6 <br/>
i = 2 and j = 7 <br/>
i = 3 and j = 8 <br/>
i = 4 and j = 9 <br/>
<strong>别忘了在范围外面加上括号</strong></p></blockquote>

<h3>对迭代器(On iterators):</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="kd">let</span> <span class="n">lines</span> <span class="o">=</span> <span class="s">&quot;hello</span><span class="se">\n</span><span class="s">world&quot;</span><span class="p">.</span><span class="n">lines</span><span class="p">();</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">linenumber</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="k">in</span> <span class="n">lines</span><span class="p">.</span><span class="n">enumerate</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}:{}&quot;</span><span class="p">,</span> <span class="n">linenumber</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>输出:<br/>
0:hello <br/>
1:world <br/></p></blockquote>
</div>
  
  


      <footer>
      
      - <a href="/blog/2016/09/21/cong-ling-kai-shi-de-rust-enumeratefang-fa/">从零开始的Rust-Enumerate方法</a>
      <time datetime="2016-09-21T19:37:14+08:00" pubdate><span class='month'>Sep</span> <span class='day'>21</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/xue-xi-xin-de/'>学习心得</a></span>
      
      </footer>
    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/06/jian-dan-catde-shi-xian-1-dot-0/">简单cat的实现-1.0</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-09-06T23:47:23+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>简单cat的实现-1.0</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ctype.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">vis</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">strip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span><span class="sc">&#39;-&#39;</span><span class="p">){</span>
</span><span class='line'>        <span class="k">switch</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]){</span>
</span><span class='line'>        <span class="k">case</span> <span class="sc">&#39;s&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="n">strip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">default</span><span class="o">:</span>
</span><span class='line'>            <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">&quot;%s:unknown arg %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">argc</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>        <span class="n">argv</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="n">vis</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">argc</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span><span class="p">((</span><span class="n">fp</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s">&quot;r&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">){</span>
</span><span class='line'>        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">&quot;%s:can&#39;t open %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="n">vis</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span><span class='line'>        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">vis</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">){</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span><span class="p">((</span><span class="n">c</span><span class="o">=</span><span class="n">getc</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span><span class="o">!=</span><span class="n">EOF</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">isascii</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">isprint</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;\n&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39;\t&#39;</span> <span class="o">||</span> <span class="n">c</span><span class="o">==</span><span class="sc">&#39; &#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">putchar</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strip</span><span class="p">)</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">%03o&quot;</span><span class="p">,</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


      <footer>
      
      - <a href="/blog/2016/09/06/jian-dan-catde-shi-xian-1-dot-0/">简单cat的实现-1.0</a>
      <time datetime="2016-09-06T23:47:23+08:00" pubdate><span class='month'>Sep</span> <span class='day'>06</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/lian-xi-dai-ma/'>练习代码</a></span>
      
      </footer>
    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/01/wo-de-suan-fa-tian-ti-zhi-lu-zhi-zui-da-zi-zhen-lie/">我的算法天梯之路之-最大子阵列</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-09-01T17:51:01+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>我的算法天梯之路之-最大子阵列</h2>

<blockquote><p>在一个数组中找出和最大的连续几个数。（至少包含一个数）<br/>
例如：<br/>
数组A[] = [−2, 1, −3, 4, −1, 2, 1, −5, 4]，则连续的子序列[4,−1,2,1]有最大的和6.<br/>
输入格式<br/>
第一行输入一个不超过1000的整数n。<br/>
第二行输入n个整数A[i]。<br/>
输出格式<br/>
第一行输出一个整数，表示最大的和。<br/></p></blockquote>

<p><strong>样例输入</strong></p>

<blockquote><p>3<br/>
1 1 -2<br/>
<strong>样例输出</strong>
<br/>
2<br/></p></blockquote>

<p><strong>示例代码</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'> <span class="cp">#define N 1001</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">maxsum</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">[],</span><span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="n">b</span><span class="o">+=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="k">else</span> <span class="n">b</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">&gt;</span><span class="n">sum</span><span class="p">)</span>
</span><span class='line'>        <span class="n">sum</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
</span><span class='line'>    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>    <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="n">maxsum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">));</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


      <footer>
      
      - <a href="/blog/2016/09/01/wo-de-suan-fa-tian-ti-zhi-lu-zhi-zui-da-zi-zhen-lie/">我的算法天梯之路之-最大子阵列</a>
      <time datetime="2016-09-01T17:51:01+08:00" pubdate><span class='month'>Sep</span> <span class='day'>01</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/suan-fa-bi-ji/'>算法笔记</a></span>
      
      </footer>
    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/21/zhuan-linux-on-android-zai-androidshou-ji-shang-pao-linuxjiao-cheng/">(转)Linux on Android——在Android手机上跑Linux教程</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-08-21T17:15:20+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>(转)Linux On Android——在Android手机上跑Linux教程(以Ubuntu14.04-core为例）</h2>

<p>前言</p>

<p>Android 是基于 Linux 内核的开源操作系统，主要用在移动设备上。当然同样是基于 Linux 内核的操作系统，现在支持的 Android 的智能手机理论来说都能运行基于 Linux 的操作系统，比如现在流行的发行版：Ubuntu、Fedora 等等。不仅如此，现在的智能移动设备的硬件也越来越强，更为能运行 Linux 系统提供了良好的硬件支持。今天就带大家来尝试一下在 Android 手机上安装 Ubuntu14.04操作系统。
有关说明:</p>

<ul>
<li><strong>原帖点<a href="http://www.jianshu.com/p/3c5f792bca1f">这里</a></strong></li>
<li><strong>注:ubuntu14.04-core类似于Ubuntu系列的服务器版本,想使用图形界面的朋友可以在系统安装完成后,自行下载Ubuntu的图形界面(KDE,GNOME,XFCE或LXDE,而在图形界面方面博主较为推荐LXDE,轻便,简捷,占用资源及空间较少.但是用户友好度不高,适合低配低容量手机(装在SD卡的读者可以无视这个建议!))</strong></li>
<li><strong>想用图形界面,但又怕安装图形界面麻烦的读者可以直接安装Ubuntu12.04-Full,更多其他linux发行版可以在sourceforge.net的LinuxonAndroid目录列表中查询,详情可以继续往下阅读.</strong></li>
</ul>


<h3>配置要求</h3>

<ul>
<li><strong>设备需要 root 权限(重点,没有root的手机以下的关键操作基本都无法执行)，并且安装了 BusyBox</strong></li>
<li>最小 1GHz 处理器(推荐)</li>
<li>Android 系统版本 2.1 或以上</li>
<li>手机容量,一般有张4GB的SD卡就够了(其他像kali的映像(至少5G)除外) (安装full映像需要3.5GB,small映像需要2G,core映像则只需要1G)</li>
<li>支持 Ext2 文件系统(大部分 Android 设备应该都支持)</li>
</ul>


<h3>博主设备</h3>

<ul>
<li>手机型号:lenvon A5500</li>
<li>处理器主频:1.6GHz</li>
<li>无SD卡(由于博主装的是core版,使用1G的机身空余容量即可)</li>
<li>Android版本:5.0</li>
</ul>


<h3>需要的软件(此处清单基本照抄原帖主)</h3>

<ul>
<li><a href="https://play.google.com/store/apps/details?id=jackpal.androidterm">Android Terminal Emulator (终端模拟器)</a> ：用于运行 shell 脚本</li>
<li><a href="https://play.google.com/store/apps/details?id=stericson.busybox">BusyBox</a> ：用于提供 shell 命令的支持</li>
<li><a href="https://play.google.com/store/apps/details?id=android.androidVNC">Android VNC Viewer</a>：用于 Android 设备的远程连接工具</li>
<li><a href="http://sourceforge.net/projects/linuxonandroid/files/">Ubuntu 14.04-core的映像文件</a>：用于安装 Ubuntu 的映像文件(该网站中有很多 Linux 发行版，大家也可以尝试其他发行版)</li>
<li>ubuntu.sh：Ubuntu 的安装脚本

<ul>
<li>链接：<a href="http://pan.baidu.com/s/1hqgVxvY">http://pan.baidu.com/s/1hqgVxvY</a> 密码：o0xa</li>
</ul>
</li>
<li>bootscript.sh：Ubuntu 的启动脚本

<ul>
<li>链接：<a href="http://pan.baidu.com/s/1pJkeSkF">http://pan.baidu.com/s/1pJkeSkF</a> 密码：whfe</li>
</ul>
</li>
</ul>


<h2>开始安装</h2>

<h3>0. 取得 ROOT 权限</h3>

<p>首先您的手机需要 root，也就是能够获得root权限去操作，相当于越狱。不懂的可以去 Google 一下“Android获取root权限”。root是前提，所以先要把这个做好，不过现在很多ROM都做的很好，比如MIUI就有很好的权限管理。</p>

<h3>1. 安装文件下载</h3>

<p>首先就是下载必要的文件，这个是在 sourceforge.net 上的一个叫 Linux-on-Android 的项目。
我上面给的地址中有一般三个包可供下载(Ubuntu14.04除外,目前只有core版)：</p>

<p>其实下面就有英文的介绍，我就在这里简单介绍一下：</p>

<blockquote><p>   full 映像包含了完整的 Ubuntu 系统，其中包括 Unity 桌面，还有很多如GIMP等常用软件，非常齐全。需要 3.5G 以上空间。</p>

<p>   small 映像包含了的基本的 Ubuntu 系统，其中包括 LXDE 桌面，需要 2G 以上空间。</p>

<p>   core 映像包含了基础的 Ubuntu 系统，不过这个没有GUI的，也就是没有桌面只有命令行。</p></blockquote>

<p>下载完待安装的 Ubuntu 14.04-core 的映像文件，然后我们安装还需要安装脚本，也就是上面说的 ubuntu.sh ，还有安装后的启动脚本 bootscript.sh 。有了这些文件后我们在手机的根目录，新建一个文件夹取名为 ubuntu ，然后把这里我们刚才下载好的文件放到这个文件夹里面，到这里 ubuntu 文件夹里就分别有 ubuntu.img、ubuntu.sh、bootcript.sh 这三个文件了。</p>

<p><strong>注:由于原帖主安装的是Ubuntu12.04,文件系统才用的是ext2,而此处我们要安装的是Ubuntu14.04-core所以两个脚本文件的内容有些许的出入,大家用编辑器将两个.sh文件打开,用搜索替换功能将脚本里面的"ext2"替换成"ext4"保存退出即可.</strong></p>

<h2>安装软件(此处照搬原帖,博主懒得码字了&hellip;)</h2>

<p>首先需要的是 Terminal 这个软件，也就是一个终端，通过终端我们可以用来执行很多命令和脚本。上面我给出了Google Play的地址，这个在很多地方都有的下的，还有Android VNC Viewer也可以在 Google Play 里面找到安装。</p>

<p>在这里我要说一下 BusyBox，它使得你可以在 Terminal 中运行很多命令，现在很多 Android 的 Rom (我用的MIUI_v4_2.8.10也是) 的终端中很多命令都不能运行，比如 cp、mv、cut 等，但是这些都是我们脚本里面需要用到的，如果不能运行这些命令而执行脚本的话，会提示 **: not found 这样的提示。所以安装 BusyBox 可以使得这些命令都能够在终端里面执行。如果你的Rom本来够强大已经包含了BusyBox的新版本，能够运行基本的shell命令的话，那也可以不用装这个。</p>

<p>当然安装 BusyBox 以及后面我们在 Terminal 中都需要 root 权限，如果是MIUI系统的话则可以直接在 授权管理 > ROOT权限管理 里面打开该选项，然后需要root权限的时候允许就可以了。其他的系统我没用过，不过可以直接用 一键ROOT工具 来操作。</p>

<p>安装 BusyBox，安装好后，打开BusyBox点击 Install 开始安装，如果弹出需要ROOT权限，点下一步允许就行!</p>

<h2>安装 ubuntu 14.04-core</h2>

<p>首先，打开 终端模拟器(Terminal) ，在光标处输入 “cd /ubuntu”(不包括引号，注意cd后有空格)然后回车，这样就来到了刚才我们在SD卡里面新建的目录了.</p>

<p>接下来我们就要开始运行 ubuntu.sh 这个安装脚本了，但在这之前我们需要使用 root 用户来运行这个脚本，在终端中使用命令 “su” 来切换至 root 用户权限，如果弹出授权信息点击下一步允许就行了，或者直接用 一键ROOT 来开启终端重复上面操作，成功后如图之前的“$”变成了“#”，这就说明已经获得Root权限了</p>

<p>然后运行安装脚本，输入命令 “sh ubuntu.sh”，进行安装</p>

<p>然后脚本为你建立了一个名字为“ubuntu”的帐号，这里提示你需要为你的帐号设置一个密码，这个密码会在以后你操作 Ubuntu 的时候一些授权应用到，比如我在这里设置密码为：“ubuntu”，这里注意的是在终端里面输入密码是不会显示出来的，你看见光标没有动静，但实际上你已经输入进去了。回车后提示再次输入密码以保证你两次密码一样</p>

<p>密码设置完成后，提示是否启动VNC服务和SSH服务，我们只要输入“y”然后回车，开启了这两个服务后我们才能通过远程连接来连上系统</p>

<p>然后提示我们输入设备屏幕的尺寸，我的屏幕是1280x800的，所以我输入“1280x800”（小米手机注意：小米手机是854×480的，但是后面用Android VNC 连接的时候有问题，在右边会显示一条线，所以小米手机用户最好设置成“852×480”，其他手机没有测试过，在设置的时候请注意！）。注意：这里两个数字之间的不是乘号，而是字母“xyz”的“x”，输错了不能远程连接的.</p>

<p>然后，提示是否保存你刚才的设置为默认设置，只要输入“y”即可</p>

<p>然后你就可以看到操作完成后光标前的字符变成了“root@localhost:~#”，这样说明你已经成功进入ubuntu系统中了.</p>

<h2>远程桌面连接</h2>

<p>自行查询VNC的使用说明,在此博主不再赘述.
连接ip:localhost:5900(其中":5900",可填可不填)
密码:ubuntu</p>

<h2>退出 Ubuntu 系统</h2>

<p>只需要回到刚才我们运行的终端，输入命令 “exit” 回车，等待片刻即可退出 Ubuntu 系统，再次输入 “exit” 回车 则是退出手机终端的 root 用户权限，然后再次 “exit” 回车后则是退出手机终端，这样就完全退出了</p>

<h2>下次启动</h2>

<p>下次启动的时候只需要开启 终端，然后输入 “su” 获得 root 权限，再输入 “cd /ubuntu” 来到ubuntu文件夹下，然后在输入 “sh bootscript.sh” 运行启动脚本就可以运行启动 Ubuntu 了，需要连接桌面的话按照上面说的用 Android VNC 就可以了。</p>

<p><strong>(其实对于一个服务器系统来说,博主更推荐使用ssh连接来代替VNC连接)</strong></p>

<p>最后补一张最终效果图(此处博主已经自行安装了LXDE桌面环境):
<img src="/images/ubuntu.jpg"></p>
</div>
  
  


      <footer>
      
      - <a href="/blog/2016/08/21/zhuan-linux-on-android-zai-androidshou-ji-shang-pao-linuxjiao-cheng/">(转)Linux On Android——在Android手机上跑Linux教程</a>
      <time datetime="2016-08-21T17:15:20+08:00" pubdate><span class='month'>Aug</span> <span class='day'>21</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/zhuan-zai-fen-xiang/'>转载分享</a></span>
      
      </footer>
    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/12/wo-de-suan-fa-tian-ti-zhi-lu-zhi-gui-bing-pai-xu/">我的算法天梯之路之-归并排序</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-08-12T10:44:05+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>我的算法天梯之路之-归并排序</h2>

<p>插入排序算法采取增量式(Incremental)的策略解决问题,每次添一个元素到已排序的子序列
中,逐渐将整个数组排序完毕,它的时间复杂度是Θ(n<sup>2</sup>)。下面介绍另一个典型的排序算法&ndash;
归并排序,它采取分而治之(Divide-and-Conquer)的策略,时间复杂度是Θ(nlgn),优于插入
排序算法。归并排序的步骤如下:</p>

<ol>
<li>Divide: 把长度为n的输入序列分成两个长度为n/2的子序列。</li>
<li>Conquer: 对这两个子序列分别采用归并排序。</li>
<li>Combine: 将两个排序好的子序列合并成一个最终的排序序列。</li>
</ol>


<p>在描述归并排序的步骤时又调用了归并排序本身,可见这是一个递归的过程。</p>

<p><strong>示例代码</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'> <span class="cp">#define LEN 8</span>
</span><span class='line'> <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">LEN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">};</span>
</span><span class='line'> <span class="kt">void</span> <span class="nf">merge</span><span class="p">(</span><span class="kt">int</span> <span class="n">start</span><span class="p">,</span><span class="kt">int</span> <span class="n">mid</span><span class="p">,</span><span class="kt">int</span> <span class="n">end</span><span class="p">){</span>
</span><span class='line'>     <span class="kt">int</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>     <span class="kt">int</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">mid</span><span class="p">;</span>
</span><span class='line'>     <span class="kt">int</span> <span class="n">left</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span><span class="n">right</span><span class="p">[</span><span class="n">n2</span><span class="p">];</span>
</span><span class='line'>     <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>
</span><span class='line'>     <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>     <span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>     <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">n2</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>     <span class="n">right</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">];</span>
</span><span class='line'>     <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>     <span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n1</span> <span class="o">&amp;&amp;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n2</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>         <span class="k">if</span> <span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">[</span><span class="n">j</span><span class="p">]){</span>
</span><span class='line'>             <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>             <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>         <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>             <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span><span class='line'>             <span class="n">j</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>     <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n1</span><span class="p">)</span>
</span><span class='line'>     <span class="k">for</span><span class="p">(;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>         <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>         <span class="n">k</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>     <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">n2</span><span class="p">)</span>
</span><span class='line'>     <span class="k">for</span> <span class="p">(;</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">n2</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>         <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span><span class='line'>         <span class="n">k</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'> <span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="kt">int</span> <span class="n">start</span><span class="p">,</span><span class="kt">int</span> <span class="n">end</span><span class="p">){</span>
</span><span class='line'>     <span class="kt">int</span> <span class="n">mid</span><span class="p">;</span>
</span><span class='line'>     <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">){</span>
</span><span class='line'>         <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'>         <span class="n">printf</span><span class="p">(</span><span class="s">&quot;sort (%d-%d,%d-%d) %d,%d,%d,%d,%d,%d,%d,%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">start</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="p">,</span>
</span><span class='line'>                <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span class='line'>         <span class="n">sort</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span>
</span><span class='line'>         <span class="n">sort</span><span class="p">(</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="p">);</span>
</span><span class='line'>         <span class="n">merge</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">end</span><span class="p">);</span>
</span><span class='line'>         <span class="n">printf</span><span class="p">(</span><span class="s">&quot;merge (%d-%d,%d-%d) %d,%d,%d,%d,%d,%d,%d,%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">start</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">end</span><span class="p">,</span>
</span><span class='line'>                <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span><span class='line'>     <span class="n">sort</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">LEN</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>在merge函数中演示了C99的新特性&ndash;可变长数组,当然
也可以避免使用这一特性,比如把left和right都按最大长度LEN分配。</p></blockquote>

<h3>程序耗时</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">time</span> <span class="p">.</span><span class="o">/</span><span class="n">sort</span>
</span><span class='line'><span class="n">sort</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span> <span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">sort</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">sort</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">merge</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">sort</span> <span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">merge</span> <span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">merge</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">sort</span> <span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">sort</span> <span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">merge</span> <span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">sort</span> <span class="p">(</span><span class="mi">6</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">merge</span> <span class="p">(</span><span class="mi">6</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">merge</span> <span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span>
</span><span class='line'><span class="n">merge</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="o">-</span><span class="mi">7</span><span class="p">)</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span>
</span><span class='line'>
</span><span class='line'><span class="n">real</span>   <span class="mi">0</span><span class="n">m0</span><span class="mf">.001</span><span class="n">s</span>
</span><span class='line'><span class="n">user</span>   <span class="mi">0</span><span class="n">m0</span><span class="mf">.000</span><span class="n">s</span>
</span><span class='line'><span class="n">sys</span>    <span class="mi">0</span><span class="n">m0</span><span class="mf">.000</span><span class="n">s</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>相比之下冒泡排序在时间复杂度上就较为逊色了,且要排序的元素越多时,差别越大!</strong></p>

<p><strong>示例代码</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'> <span class="cp">#define LEN 8</span>
</span><span class='line'> <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="n">LEN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="p">};</span>
</span><span class='line'> <span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="kt">int</span> <span class="n">start</span><span class="p">,</span> <span class="kt">int</span> <span class="n">end</span><span class="p">)</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>     <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">temp</span><span class="p">;</span>
</span><span class='line'>     <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>         <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">end</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>             <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>                 <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]){</span>
</span><span class='line'>                 <span class="n">temp</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>                 <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
</span><span class='line'>                 <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
</span><span class='line'>                 <span class="p">}</span>
</span><span class='line'>             <span class="p">}</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>         <span class="n">printf</span><span class="p">(</span><span class="s">&quot;sort (%d-%d) %d %d %d %d %d %d %d %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span>
</span><span class='line'>                <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'> <span class="n">sort</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">LEN</span><span class="p">);</span>
</span><span class='line'> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>程序耗时</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">time</span> <span class="p">.</span><span class="o">/</span><span class="n">sort2</span>
</span><span class='line'><span class="n">sort</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span>
</span><span class='line'>
</span><span class='line'><span class="n">real</span>   <span class="mi">0</span><span class="n">m0</span><span class="mf">.002</span><span class="n">s</span>
</span><span class='line'><span class="n">user</span>   <span class="mi">0</span><span class="n">m0</span><span class="mf">.000</span><span class="n">s</span>
</span><span class='line'><span class="n">sys</span>    <span class="mi">0</span><span class="n">m0</span><span class="mf">.000</span><span class="n">s</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


      <footer>
      
      - <a href="/blog/2016/08/12/wo-de-suan-fa-tian-ti-zhi-lu-zhi-gui-bing-pai-xu/">我的算法天梯之路之-归并排序</a>
      <time datetime="2016-08-12T10:44:05+08:00" pubdate><span class='month'>Aug</span> <span class='day'>12</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/suan-fa-bi-ji/'>算法笔记</a></span>
      
      </footer>
    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/11/gdbde-jian-dan-shi-yong/">Gdb的简单使用</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-08-11T14:26:20+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>gdb的简单使用</h2>

<h3>1.单步执行和跟踪函数调用</h3>

<p><strong>测试源码</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">add_range</span><span class="p">(</span><span class="kt">int</span> <span class="n">low</span><span class="p">,</span><span class="kt">int</span> <span class="n">high</span><span class="p">)</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">sum</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">low</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">high</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;sum = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">sum</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">result</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span><span class='line'>    <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">add_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>    <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">add_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;result[0]=%d </span><span class="se">\n</span><span class="s"> result[1]=%d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>在编译并运行以上代码后,我们会发现最后的输出结果并非如我们预料一样.
无论是result[0]或result[1]基本都是错误的结果,然而代码中的逻辑却没有任何的问题.
在这里心细的朋友可能已经发现问题的所在了.
但既然是练习gdb的使用,那么我们就加上 -g 选项,再重新编译一次代码以便生成的可执行文件可以用gdb进行调试.</p>

<blockquote><p>$ gcc -g main.c -o main
$ gdb main</p></blockquote>

<p><strong>注:-g选项的作用是在可执行文件中加入源代码的信息,比如可执行文件中第几条机器指令对应源代码的第几行,但并不是把整个源文件嵌入到可执行文件中,所以在调试时必须保证gdb能找到源文件</strong></p>

<p><strong>除此之外</strong>,gdb提供一个类似shell的命令行环境,上面的 (gdb) 就是提示符,在这个提示符下输
入help可以查看命令的类别.</p>

<p><strong>help命令</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">help</span>
</span><span class='line'><span class="n">List</span> <span class="n">of</span> <span class="n">classes</span> <span class="n">of</span> <span class="nl">commands</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'><span class="n">aliases</span> <span class="o">--</span> <span class="n">Aliases</span> <span class="n">of</span> <span class="n">other</span> <span class="n">commands</span>
</span><span class='line'><span class="n">breakpoints</span> <span class="o">--</span> <span class="n">Making</span> <span class="n">program</span> <span class="n">stop</span> <span class="n">at</span> <span class="n">certain</span> <span class="n">points</span>
</span><span class='line'><span class="n">data</span> <span class="o">--</span> <span class="n">Examining</span> <span class="n">data</span>
</span><span class='line'><span class="n">files</span> <span class="o">--</span> <span class="n">Specifying</span> <span class="n">and</span> <span class="n">examining</span> <span class="n">files</span>
</span><span class='line'><span class="n">internals</span> <span class="o">--</span> <span class="n">Maintenance</span> <span class="n">commands</span>
</span><span class='line'><span class="n">obscure</span> <span class="o">--</span> <span class="n">Obscure</span> <span class="n">features</span>
</span><span class='line'><span class="n">running</span> <span class="o">--</span> <span class="n">Running</span> <span class="n">the</span> <span class="n">program</span>
</span><span class='line'><span class="n">stack</span> <span class="o">--</span> <span class="n">Examining</span> <span class="n">the</span> <span class="n">stack</span>
</span><span class='line'><span class="n">status</span> <span class="o">--</span> <span class="n">Status</span> <span class="n">inquiries</span>
</span><span class='line'><span class="n">support</span> <span class="o">--</span> <span class="n">Support</span> <span class="n">facilities</span>
</span><span class='line'><span class="n">tracepoints</span> <span class="o">--</span> <span class="n">Tracing</span> <span class="n">of</span> <span class="n">program</span> <span class="n">execution</span> <span class="n">without</span> <span class="n">stopping</span> <span class="n">the</span> <span class="n">program</span>
</span><span class='line'><span class="n">user</span><span class="o">-</span><span class="n">defined</span> <span class="o">--</span> <span class="n">User</span><span class="o">-</span><span class="n">defined</span> <span class="n">commands</span>
</span><span class='line'>
</span><span class='line'><span class="n">Type</span> <span class="s">&quot;help&quot;</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">a</span> <span class="n">class</span> <span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">commands</span> <span class="n">in</span> <span class="n">that</span> <span class="n">class</span><span class="p">.</span>
</span><span class='line'><span class="n">Type</span> <span class="s">&quot;help all&quot;</span> <span class="k">for</span> <span class="n">the</span> <span class="n">list</span> <span class="n">of</span> <span class="n">all</span> <span class="n">commands</span><span class="p">.</span>
</span><span class='line'><span class="n">Type</span> <span class="s">&quot;help&quot;</span> <span class="n">followed</span> <span class="n">by</span> <span class="n">command</span> <span class="n">name</span> <span class="k">for</span> <span class="n">full</span> <span class="n">documentation</span><span class="p">.</span>
</span><span class='line'><span class="n">Type</span> <span class="s">&quot;apropos word&quot;</span> <span class="n">to</span> <span class="n">search</span> <span class="k">for</span> <span class="n">commands</span> <span class="n">related</span> <span class="n">to</span> <span class="s">&quot;word&quot;</span><span class="p">.</span>
</span><span class='line'><span class="n">Command</span> <span class="n">name</span> <span class="n">abbreviations</span> <span class="n">are</span> <span class="n">allowed</span> <span class="k">if</span> <span class="n">unambiguous</span><span class="p">.</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>list命令</strong>
list命令用于列出代码或指定函数,列出的代码行的起始位置为上一次列出的代码的结尾,
第一次使用时,默认从第一行开始.每次默认列出十行代码.list命令也可简写成l.
要是要列出指定函数的代码,直接在list后面加函数名即可.</p>

<blockquote><p>eg: list add_range</p></blockquote>

<p>且可以通过 show listsize  和 show listsize NUM(NUM为整数)来查询和修改每次最大列出代码行数.</p>

<p><strong>在什么都不输入的情况下敲击回车,gdb默认会执行上一条命令</strong></p>

<p><strong>quit命令</strong>
退出gdb环境</p>

<p><strong>start命令</strong>
开始执行程序,start命令默认停在main函数变量定义后的第一条语句,并等待下一次命令.</p>

<p><strong>next命令(简写n)</strong>
单步步过</p>

<p><strong>step命令(简写s)</strong>
单步步入</p>

<p><strong>backtrace命令(简写bt)</strong>
查看函数调用栈帧</p>

<p><strong>info命令(简写i)</strong>
查询相关信息</p>

<blockquote><p>eg:查询add_range函数局部变量的值,i locals</p></blockquote>

<p><strong>print命令(简写p)</strong>
打印指定变量值</p>

<p><strong>finish命令</strong>
执行到返回</p>

<p>介绍完以上几个简单的命令之后再返回到测试代码的调试之中.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">start</span>
</span><span class='line'><span class="n">Temporary</span> <span class="n">breakpoint</span> <span class="mi">1</span> <span class="n">at</span> <span class="mh">0x80484c7</span><span class="o">:</span> <span class="n">file</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest2</span><span class="p">.</span><span class="n">c</span><span class="p">,</span> <span class="n">line</span> <span class="mf">13.</span>
</span><span class='line'><span class="n">Starting</span> <span class="nl">program</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ef</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">gdbtest2</span>
</span><span class='line'>
</span><span class='line'><span class="n">Temporary</span> <span class="n">breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="n">main</span> <span class="p">()</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest2</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">13</span>
</span><span class='line'><span class="mi">13</span>    <span class="p">{</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">n</span>
</span><span class='line'><span class="mi">15</span>        <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">add_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">s</span>
</span><span class='line'><span class="n">add_range</span> <span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest2</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">5</span>
</span><span class='line'><span class="mi">5</span>     <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">low</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">high</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">bt</span>
</span><span class='line'><span class="cp">#0  add_range (low=1, high=10) at ./gdbtest2.c:5</span>
</span><span class='line'><span class="cp">#1  0x080484de in main () at ./gdbtest2.c:15</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">i</span> <span class="n">locals</span>
</span><span class='line'><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1208074951</span>
</span><span class='line'><span class="n">sum</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1208114904</span>
</span></code></pre></td></tr></table></div></figure>


<p>在以上最后两行输出我们可以明白,程序之所以没有输出我们预期的结果,
其根本原因就是因为局部变量i和sum没有进行初始化.虽然变量i会在for循环之前进行重新赋值,
但作为累积变量的sum由于初始值不是0,导致最后的累加结果错误.</p>

<p>找出错误的所在后,我们即可以退出gdb,修改源码再重新进行调试;或者直接通过gdb的命令</p>

<blockquote><p>set var sum = 0</p></blockquote>

<p>修改局部变量sum的值,然后再寻找下一处Bug.</p>

<h3>2.断点的使用</h3>

<p><strong>测试代码</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">input</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;input=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>编译以上代码并运行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">gcc</span> <span class="n">main</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">o</span> <span class="n">main</span>
</span><span class='line'><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">main</span>
</span><span class='line'><span class="mi">123</span>
</span><span class='line'><span class="n">input</span><span class="o">=</span><span class="mi">123</span>
</span><span class='line'><span class="mi">234</span>
</span><span class='line'><span class="n">input</span><span class="o">=</span><span class="mi">123234</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们发现程序第一次运行是对的,但第二次却又出乎了我们意料.
于是我们也把这个程序也放入gdb中调试.</p>

<p><strong>display命令</strong>
display命令可以使得每次停下来的时候都显示执行变量的值,亦称变量跟踪.</p>

<p><strong>undisplay命令</strong>
取消之前设置的变量跟踪</p>

<p><strong>break命令(简称b)</strong>
在指定位置设定断点,参数可以是指定行也可以是某个函数</p>

<p><strong>i breakpoints</strong>
输出目前已有断点的信息</p>

<p><strong>enable breakpoints NUM(NUM为断点号)</strong>
启用指定断点(NUM为空时,默认为全部断点)</p>

<p><strong>disable breakpoints NUM(NUM为断点号)</strong>
禁用指定断点(NUM为空时,默认为全部断点)</p>

<p><strong>delete breakpoints NUM(NUM为断点号)</strong>
删除指定断点(NUM为空时,默认为全部断点)</p>

<p><strong>continue命令(简称c)</strong>
继续执行,注意,continue命令是连续运行而非单步执行.</p>

<p>介绍完命令后我们又再次回到调试中,首先我们执行完start命令后,使用</p>

<blockquote><p>b 9</p></blockquote>

<p>在sum的赋值处下一个断点,并用命令</p>

<blockquote><p>display sum</p></blockquote>

<p>来时刻监视变量sum的变化<br/>
这时我们发现在我们输入完"123"后,再次想输入"456"时,gdb显示
&ldquo;sum = 123&rdquo; ,这样我们便发现错误所在,即我们并没有在新的循环中清空sum的先值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">start</span>
</span><span class='line'><span class="n">Temporary</span> <span class="n">breakpoint</span> <span class="mi">1</span> <span class="n">at</span> <span class="mh">0x804848c</span><span class="o">:</span> <span class="n">file</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest3</span><span class="p">.</span><span class="n">c</span><span class="p">,</span> <span class="n">line</span> <span class="mf">3.</span>
</span><span class='line'><span class="n">Starting</span> <span class="nl">program</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ef</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">gdbtest3</span>
</span><span class='line'>
</span><span class='line'><span class="n">Temporary</span> <span class="n">breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="n">main</span> <span class="p">()</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest3</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">3</span>
</span><span class='line'><span class="mi">3</span> <span class="p">{</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">list</span>
</span><span class='line'><span class="mi">1</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'><span class="mi">2</span> <span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="mi">3</span> <span class="p">{</span>
</span><span class='line'><span class="mi">4</span> <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="mi">5</span> <span class="kt">char</span> <span class="n">input</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</span><span class='line'><span class="mi">6</span> <span class="nf">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="mi">7</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
</span><span class='line'><span class="mi">8</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'><span class="mi">9</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="mi">10</span>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;input=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sum</span><span class="p">);</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">b</span> <span class="mi">9</span>
</span><span class='line'><span class="n">Breakpoint</span> <span class="mi">2</span> <span class="n">at</span> <span class="mh">0x80484c2</span><span class="o">:</span> <span class="n">file</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest3</span><span class="p">.</span><span class="n">c</span><span class="p">,</span> <span class="n">line</span> <span class="mf">9.</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">display</span> <span class="n">sum</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">134514011</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">c</span>
</span><span class='line'><span class="n">Continuing</span><span class="p">.</span>
</span><span class='line'><span class="mi">123</span>
</span><span class='line'>
</span><span class='line'><span class="n">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="n">main</span> <span class="p">()</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest3</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">9</span>
</span><span class='line'><span class="mi">9</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">c</span>
</span><span class='line'><span class="n">Continuing</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="n">main</span> <span class="p">()</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest3</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">9</span>
</span><span class='line'><span class="mi">9</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">c</span>
</span><span class='line'><span class="n">Continuing</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="n">main</span> <span class="p">()</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest3</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">9</span>
</span><span class='line'><span class="mi">9</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">c</span>
</span><span class='line'><span class="n">Continuing</span><span class="p">.</span>
</span><span class='line'><span class="n">input</span><span class="o">=</span><span class="mi">123</span>
</span><span class='line'><span class="mi">456</span>
</span><span class='line'>
</span><span class='line'><span class="n">Breakpoint</span> <span class="mi">2</span><span class="p">,</span> <span class="n">main</span> <span class="p">()</span> <span class="n">at</span> <span class="p">.</span><span class="o">/</span><span class="n">gdbtest3</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">9</span>
</span><span class='line'><span class="mi">9</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">123</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


      <footer>
      
      - <a href="/blog/2016/08/11/gdbde-jian-dan-shi-yong/">gdb的简单使用</a>
      <time datetime="2016-08-11T14:26:20+08:00" pubdate><span class='month'>Aug</span> <span class='day'>11</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/linuxza-tan/'>linux杂谈</a></span>
      
      </footer>
    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/10/linuxjin-cheng-nei-cun-guan-li/">Linux进程内存管理</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-08-10T11:24:22+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>Linux进程内存管理</h2>

<h3>1.程序的结构与进程结构</h3>

<p>$ size test</p>

<blockquote><p>text       data     bss     dec     hex filename <br/>
181617      432   18844  200893   310bd ./book <br/></p></blockquote>

<p><strong>一个可执行程序包括三个部分</strong> <br/>
代码段:存放指令,操作以及只读的常量<br/>
数据段:全局或者静态的已经初始化的变量<br/>
BSS段 :全局或者静态的未初始化的变量<br/></p>

<h3>2.进程管理的过程</h3>

<p>在执行程序时,系统首先在内核空间中创建一个进程,为这个进程申请一个PCB
(进程控制块task_struct),用于管理整个进程的所有资源,其中mm_struct成员用来管理与当前
进程相关的所有内存资源.</p>

<blockquote><p>(1)代码段,数据段,BSS段,直接从磁盘拷贝到当前内存空间,大小相等.<br/>
(2)动态的空间:堆,栈空间,mmap段(用于映射其他的库的相关信息)</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /proc/7450/maps
</span><span class='line'>08048000-08152000 r-xp 00000000 08:01 36175926   /bin/bash
</span><span class='line'>08152000-08153000 r--p 00109000 08:01 36175926   /bin/bash
</span><span class='line'>08153000-08158000 rw-p 0010a000 08:01 36175926   /bin/bash
</span><span class='line'>08158000-0815d000 rw-p 00000000 00:00 0 
</span><span class='line'>084cf000-08994000 rw-p 00000000 00:00 0          [heap]
</span><span class='line'>b710d000-b7118000 r-xp 00000000 08:01 21496849   /lib/i386-linux-gnu/libnss_files-2.23.so
</span><span class='line'>b7118000-b7119000 r--p 0000a000 08:01 21496849   /lib/i386-linux-gnu/libnss_files-2.23.so
</span><span class='line'>b7119000-b711a000 rw-p 0000b000 08:01 21496849   /lib/i386-linux-gnu/libnss_files-2.23.so
</span><span class='line'>b711a000-b7120000 rw-p 00000000 00:00 0 
</span><span class='line'>b7120000-b712b000 r-xp 00000000 08:01 21496770   /lib/i386-linux-gnu/libnss_nis-2.23.so
</span><span class='line'>b712b000-b712c000 r--p 0000a000 08:01 21496770   /lib/i386-linux-gnu/libnss_nis-2.23.so
</span><span class='line'>b712c000-b712d000 rw-p 0000b000 08:01 21496770   /lib/i386-linux-gnu/libnss_nis-2.23.so
</span><span class='line'>b7151000-b7158000 r--s 00000000 08:01 48245384   /usr/lib/i386-linux-gnu/gconv/gconv-modules.cache
</span><span class='line'>b7158000-b730b000 r--p 002d7000 08:01 48234512   /usr/lib/locale/locale-archive
</span><span class='line'>b730b000-b750b000 r--p 00000000 08:01 48234512   /usr/lib/locale/locale-archive
</span><span class='line'>b750b000-b750c000 rw-p 00000000 00:00 0 
</span><span class='line'>b750c000-b76bb000 r-xp 00000000 08:01 21497064   /lib/i386-linux-gnu/libc-2.23.so
</span><span class='line'>b76bb000-b76bc000 ---p 001af000 08:01 21497064   /lib/i386-linux-gnu/libc-2.23.so
</span><span class='line'>b76bc000-b76be000 r--p 001af000 08:01 21497064   /lib/i386-linux-gnu/libc-2.23.so
</span><span class='line'>b76be000-b76bf000 rw-p 001b1000 08:01 21497064   /lib/i386-linux-gnu/libc-2.23.so
</span><span class='line'>b76bf000-b76c2000 rw-p 00000000 00:00 0 
</span><span class='line'>b76c2000-b76c5000 r-xp 00000000 08:01 21497066   /lib/i386-linux-gnu/libdl-2.23.so
</span><span class='line'>b76c5000-b76c6000 r--p 00002000 08:01 21497066   /lib/i386-linux-gnu/libdl-2.23.so
</span><span class='line'>b76c6000-b76c7000 rw-p 00003000 08:01 21497066   /lib/i386-linux-gnu/libdl-2.23.so
</span><span class='line'>b76c7000-b76e7000 r-xp 00000000 08:01 21496816   /lib/i386-linux-gnu/libtinfo.so.5.9
</span><span class='line'>b76e7000-b76e9000 r--p 0001f000 08:01 21496816   /lib/i386-linux-gnu/libtinfo.so.5.9
</span><span class='line'>b76e9000-b76ea000 rw-p 00021000 08:01 21496816   /lib/i386-linux-gnu/libtinfo.so.5.9
</span><span class='line'>b76ef000-b7706000 r-xp 00000000 08:01 21496768   /lib/i386-linux-gnu/libnsl-2.23.so
</span><span class='line'>b7706000-b7707000 r--p 00016000 08:01 21496768   /lib/i386-linux-gnu/libnsl-2.23.so
</span><span class='line'>b7707000-b7708000 rw-p 00017000 08:01 21496768   /lib/i386-linux-gnu/libnsl-2.23.so
</span><span class='line'>b7708000-b770a000 rw-p 00000000 00:00 0 
</span><span class='line'>b770a000-b7712000 r-xp 00000000 08:01 21496134   /lib/i386-linux-gnu/libnss_compat-2.23.so
</span><span class='line'>b7712000-b7713000 r--p 00007000 08:01 21496134   /lib/i386-linux-gnu/libnss_compat-2.23.so
</span><span class='line'>b7713000-b7714000 rw-p 00008000 08:01 21496134   /lib/i386-linux-gnu/libnss_compat-2.23.so
</span><span class='line'>b7714000-b7715000 r--p 002d4000 08:01 48234512   /usr/lib/locale/locale-archive
</span><span class='line'>b7715000-b7717000 rw-p 00000000 00:00 0 
</span><span class='line'>b7717000-b7719000 r--p 00000000 00:00 0          [vvar]
</span><span class='line'>b7719000-b771a000 r-xp 00000000 00:00 0          [vdso]
</span><span class='line'>b771a000-b773c000 r-xp 00000000 08:01 21497056   /lib/i386-linux-gnu/ld-2.23.so
</span><span class='line'>b773c000-b773d000 rw-p 00000000 00:00 0 
</span><span class='line'>b773d000-b773e000 r--p 00022000 08:01 21497056   /lib/i386-linux-gnu/ld-2.23.so
</span><span class='line'>b773e000-b773f000 rw-p 00023000 08:01 21497056   /lib/i386-linux-gnu/ld-2.23.so
</span><span class='line'>bff73000-bff94000 rw-p 00000000 00:00 0          [stack]</span></code></pre></td></tr></table></div></figure>


<p><strong>所示地址并不是真正的物理地址,而是虚拟地址.使用虚拟地址是出于对资源的保护</strong>
对系统来说,内存资源是宝贵的,而一个程序执行并不需要立即将所有资源加载到内存,
而实际上可采用写时申请的方法
<br/></p>

<h4>虚拟地址的优点:</h4>

<ol>
<li>保护系统,避免用户程序非法访问内存造成内核崩溃.</li>
<li>节约资源,采用映射方法,使用时全用缺页的方法申请物理空间,即提高了效率也节约物理空间</li>
</ol>


<h3>3.进程地址空间的申请</h3>

<p>32bit平台下,一个进程拥有4G的虚拟地址空间</p>

<blockquote><p>映射规则 <br/>
1. 代码段,数据段,BSS段,直接从磁盘拷贝至内存.在linux 32bit平台上起始地址一般为
0x08048000<br/>
2. 堆栈,动态变化.<br/>
3. mmap映射的文件(普通文件以及库),用户需自行调用mmap函数<br/>
4. 高地址1G空间:供内核映射处理,用户空间不能直接访问<br/></p></blockquote>

<p><strong>堆和栈的起始地址是随机产生的,其目的是避免产生安全漏洞,但是可以使用brk/sbrk函数指定在堆中申请空间的起始地址</strong></p>

<p>brk/sbrk函数声明</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>   <span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'>
</span><span class='line'>   <span class="kt">int</span> <span class="nf">brk</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>  <span class="c1">//指定下次申请堆空间的起始地址</span>
</span><span class='line'>
</span><span class='line'>   <span class="kt">void</span> <span class="o">*</span><span class="nf">sbrk</span><span class="p">(</span><span class="kt">intptr_t</span> <span class="n">increment</span><span class="p">);</span>  <span class="c1">//在当前地址位置后移increament字节,为0时返回当前地址</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>代码示例:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="cp">#include&lt;stdlib.h&gt;</span>
</span><span class='line'> <span class="cp">#include&lt;stdio.h&gt;</span>
</span><span class='line'> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>     <span class="n">brk</span><span class="p">(</span><span class="mh">0x09e50000</span><span class="p">);</span>
</span><span class='line'>     <span class="n">printf</span><span class="p">(</span><span class="s">&quot;brk return:%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">sbrk</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span><span class='line'>     <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">102400</span><span class="p">);</span>
</span><span class='line'>     <span class="n">printf</span><span class="p">(</span><span class="s">&quot;new malloc:%p </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">ptr</span><span class="p">);</span>
</span><span class='line'>     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>输出结果 <br/>
brk return:0x9e50000 <br/>
new malloc:0x9e51010 <br/></p></blockquote>

<p><strong>strace工具可以追踪进程空间的加载</strong></p>

<h3>4.空间分配规则</h3>

<ol>
<li>代码段,数据段,BSS段的地址在编译时已经固定.</li>
<li>BSS的结束段与堆的起始地址之间有一定间隙,间隙大小随机.</li>
<li>brk调整的仅仅是堆中申请空间的起始值</li>
<li>系统默认认为每个进程分配的堆空间大小是固定的.使用sbrk(0)得到的是我们堆空间的结束值.</li>
<li>真正编程中,很少使用brk/sbrk调整位置</li>
</ol>


<h3>5.栈的说明</h3>

<p>栈:从高地址向低地址增长,起始值也是随机的.主要存放局部变量,
新调用子函数时函数的参数以及返回值,由OS自动管理.</p>
</div>
  
  


      <footer>
      
      - <a href="/blog/2016/08/10/linuxjin-cheng-nei-cun-guan-li/">Linux进程内存管理</a>
      <time datetime="2016-08-10T11:24:22+08:00" pubdate><span class='month'>Aug</span> <span class='day'>10</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/linuxza-tan/'>linux杂谈</a></span>
      
      </footer>
    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/08/09/linuxcheng-xu-kai-fa-ming-ling-xing-xuan-xiang-ji-can-shu/">Linux程序开发-命令行选项及参数</a></h1>
    
    
      <div class="post-meta">
        <p class="meta">
          <span class="timestamp">- 








  



<time datetime="2016-08-09T16:16:57+08:00" pubdate data-updated="true"></time> -</span>
          
        </p>
      </div>
    
  </header>


  <div class="entry-content"><h2>Linux程序开发-命令行选项及参数</h2>

<h3>1.C语言中命令行参数的读取与输出</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span><span class='line'> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">argc</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;argv[%d] = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>当命令行选项很多时,可以使用库函数获取</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">getopt</span>      <span class="c1">//短选项</span>
</span><span class='line'><span class="n">getlongopt</span>  <span class="c1">//长选项</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>函数声明</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'> <span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'> <span class="kt">int</span> <span class="nf">getopt</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="n">argv</span><span class="p">[],</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optstring</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>以下全局变量用于配合getopt函数</p>

<blockquote><p>extern char *optargr;<br/>
extern int optind;<br/>
extern int optopt;<br/>
extern int opterr;<br/></p></blockquote>

<h3>2.有关选项和参数的区别</h3>

<p>eg:</p>

<p>-a : 选项,一般表示所有</p>

<p>-h host: 其中,h表示选项,而host代表了一个主机ip也就是选项h的参数</p>

<p><strong>具体参数的解析,可以参考getopt的第三个参数的使用约定</strong></p>

<h3>3.getopt的执行过程</h3>

<p>当getopt每成功执行一次</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optarg</span><span class="p">;</span> <span class="c1">//指向下一个要扫描的参数</span>
</span><span class='line'><span class="k">extern</span> <span class="kt">int</span> <span class="n">optind</span><span class="p">;</span>   <span class="c1">//索引修改为下一个要处理的指针的下标</span>
</span><span class='line'><span class="k">extern</span> <span class="kt">int</span> <span class="n">optopt</span><span class="p">;</span>   <span class="c1">//用于存储可能的错误</span>
</span><span class='line'><span class="k">extern</span> <span class="kt">int</span> <span class="n">opterr</span><span class="p">;</span>   <span class="c1">//如果opterr == 0;则不将错误输出到标准错误输出设备</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4.getopt使用实例</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'>    <span class="n">opterr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">((</span><span class="n">result</span> <span class="o">=</span> <span class="n">getopt</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="n">argv</span><span class="p">,</span><span class="s">&quot;ab:c::&quot;</span><span class="p">))</span><span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">switch</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="sc">&#39;a&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;option=a,optopt=%c,optarg=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">optopt</span><span class="p">,</span><span class="n">optarg</span><span class="p">);</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="sc">&#39;b&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;option=b,optopt=%c,optarg=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">optopt</span><span class="p">,</span><span class="n">optarg</span><span class="p">);</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="sc">&#39;c&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;option=c,optopt=%c,optarg=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">optopt</span><span class="p">,</span><span class="n">optarg</span><span class="p">);</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="sc">&#39;?&#39;</span><span class="o">:</span>
</span><span class='line'>            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;result=?,optopt=%c,optarg=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">optopt</span><span class="p">,</span><span class="n">optarg</span><span class="p">);</span>
</span><span class='line'>        <span class="k">default</span><span class="o">:</span>
</span><span class='line'>            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;default,result=%c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">result</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;argv[%d]=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">optind</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="n">optind</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;result=-1,optind=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">optind</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>输入示例
./first -a -b host -cShell</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">输出结果</span>
</span><span class='line'><span class="n">option</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">optopt</span><span class="o">=</span><span class="p">,</span><span class="n">optarg</span><span class="o">=</span><span class="p">(</span><span class="n">null</span><span class="p">)</span>
</span><span class='line'><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=-</span><span class="n">b</span>
</span><span class='line'><span class="n">option</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">optopt</span><span class="o">=</span><span class="p">,</span><span class="n">optarg</span><span class="o">=</span><span class="n">host</span>
</span><span class='line'><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=-</span><span class="n">cShell</span>
</span><span class='line'><span class="n">option</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">optopt</span><span class="o">=</span><span class="p">,</span><span class="n">optarg</span><span class="o">=</span><span class="n">Shell</span>
</span><span class='line'><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">null</span><span class="p">)</span>
</span><span class='line'><span class="n">result</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">optind</span><span class="o">=</span><span class="mi">5</span>
</span></code></pre></td></tr></table></div></figure>


<h3>5.长选项判断函数getopt_long的声明</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">getopt</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">argv</span><span class="p">[],</span>
</span><span class='line'>                  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optstring</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optarg</span><span class="p">;</span>
</span><span class='line'><span class="k">extern</span> <span class="kt">int</span> <span class="n">optind</span><span class="p">,</span> <span class="n">opterr</span><span class="p">,</span> <span class="n">optopt</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;getopt.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">getopt_long</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span>
</span><span class='line'>                  <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">argv</span><span class="p">[],</span>
</span><span class='line'>                  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optstring</span><span class="p">,</span>          <span class="c1">//当前支持的短选项列表</span>
</span><span class='line'>                  <span class="k">const</span> <span class="k">struct</span> <span class="n">option</span> <span class="o">*</span><span class="n">longopts</span><span class="p">,</span>  <span class="c1">//长选项信息</span>
</span><span class='line'>                  <span class="kt">int</span> <span class="o">*</span><span class="n">longindex</span><span class="p">);</span>                <span class="c1">//索引</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">option</span> <span class="p">{</span>
</span><span class='line'>               <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>         <span class="c1">//选项名</span>
</span><span class='line'>               <span class="kt">int</span>         <span class="n">has_arg</span><span class="p">;</span>      <span class="c1">//是否有参数</span>
</span><span class='line'>               <span class="kt">int</span>        <span class="o">*</span><span class="n">flag</span><span class="p">;</span>         <span class="c1">//标志</span>
</span><span class='line'>               <span class="kt">int</span>         <span class="n">val</span><span class="p">;</span>          <span class="c1">//返回值</span>
</span><span class='line'>                                <span class="p">};</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">getopt_long_only</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">argv</span><span class="p">[],</span>
</span><span class='line'>                  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optstring</span><span class="p">,</span>
</span><span class='line'>                  <span class="k">const</span> <span class="k">struct</span> <span class="n">option</span> <span class="o">*</span><span class="n">longopts</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">longindex</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>第四个参数的使用示例:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">struct</span> <span class="n">optino</span> <span class="n">my_option</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>   <span class="p">{</span><span class="s">&quot;help&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="sc">&#39;h&#39;</span><span class="p">},</span>
</span><span class='line'>   <span class="p">{</span><span class="s">&quot;output&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="sc">&#39;o&#39;</span><span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>除了以上区别外,长选项与短选项的使用方法类似.</p>
</div>
  
  


      <footer>
      
      - <a href="/blog/2016/08/09/linuxcheng-xu-kai-fa-ming-ling-xing-xuan-xiang-ji-can-shu/">Linux程序开发-命令行选项及参数</a>
      <time datetime="2016-08-09T16:16:57+08:00" pubdate><span class='month'>Aug</span> <span class='day'>09</span> <span class='year'>2016</span></time>
      
      <span class="categories">posted in <a class='category' href='/blog/categories/linuxza-tan/'>linux杂谈</a></span>
      
      </footer>
    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/archives">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div><!-- /div.pagination -->
</div><!-- /div.blog-index -->

      </div><!-- /div#content -->
    </div><!-- /div#main -->
  </div><!-- /div.container -->
  <footer><div id="footer-widgets-wrapper">
  <div id="footer-first" class="footer-widget">
    <h3>About Me</h3>
    <section class="about-me">
      
      <div>
        <ul>
          
            <li>GitHub: <a href="https://github.com/EdmondFrank">@EdmondFrank</a></li>
          
          
            <li>Twitter: <a href="https://twitter.com/EdmondFrank4">@EdmondFrank4</a></li>
          
            <li>Blog: <a href="http://edmondfrank.github.io">http://edmondfrank.github.io</a></li>
        </ul>
        <p>
          この町、冗談と気まぐれと偶然でてきっているらしい。
        </p>
      </div>
    </section>
  </div><!-- /div#footer-second -->

  <div id="footer-second" class="footer-widget">
    <h3>Recent Posts</h3>
    <section id="hatena-popular" class="hatena-bookmark">
      <script language="javascript" type="text/javascript" src="https://b.hatena.ne.jp/js/widget.js" charset="utf-8"></script>
      <script language="javascript" type="text/javascript">
        Hatena.BookmarkWidget.url   = "http://edmondfrank.github.io";
        Hatena.BookmarkWidget.title = "Recent Posts";
        Hatena.BookmarkWidget.sort  = "hot";
        Hatena.BookmarkWidget.width = 0;
        Hatena.BookmarkWidget.num   = 10;
        Hatena.BookmarkWidget.theme = "notheme";
        Hatena.BookmarkWidget.load();
      </script>
    </section>
  </div><!-- /div#footer-second -->

  <div id="footer-third" class="footer-widget">
    <h3>Popular Posts</h3>
    <section id="hatena-popular" class="hatena-bookmark">
      <script language="javascript" type="text/javascript" src="https://b.hatena.ne.jp/js/widget.js" charset="utf-8"></script>
      <script language="javascript" type="text/javascript">
        Hatena.BookmarkWidget.url   = "http://edmondfrank.github.io";
        Hatena.BookmarkWidget.title = "Popular Posts";
        Hatena.BookmarkWidget.sort  = "count";
        Hatena.BookmarkWidget.width = 0;
        Hatena.BookmarkWidget.num   = 10;
        Hatena.BookmarkWidget.theme = "notheme";
        Hatena.BookmarkWidget.load();
      </script>
    </section>
  </div><!-- /div#footer-third -->
</div><!-- /div#footer-widgets-wrapper -->

<div id="credit" role="contentinfo">
  <p>
    Copyright &copy; 2017 - <a href="https://github.com/EdmondFrank/">EdmondFrank</a> -
    <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  </p>
</div>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
